<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>🔥 성능 비교 대시보드</title>
  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
  <style>
    body { font-family: Arial, sans-serif; text-align: center; margin: 20px; line-height: 1.6; }
    h1 { font-size: 2em; }
    canvas { max-width: 600px; height: 600px; margin: 30px auto; display: block; }
    a { display: inline-block; margin-top: 30px; text-decoration: none; padding: 8px 16px; border: 1px solid #ccc; border-radius: 4px; background: #fff; color: #333; }
    .explanation-section {
      max-width: 800px;
      margin: 40px auto;
      padding: 20px;
      border: 1px solid #eee;
      border-radius: 8px;
      text-align: left;
      background-color: #f9f9f9;
    }
    .explanation-section h2 {
      text-align: center;
      color: #333;
      margin-bottom: 20px;
    }
    .explanation-section h3 {
      color: #555;
      margin-top: 25px;
    }
    .explanation-section p {
      color: #666;
      margin-bottom: 10px;
    }
    .explanation-section ul {
      list-style-type: disc;
      margin-left: 20px;
      color: #666;
    }
    .explanation-section ul li {
      margin-bottom: 5px;
    }

    /* Responsive adjustments */
    @media (max-width: 768px) {
      h1 { font-size: 1.8em; }
      canvas { max-width: 90%; height: auto; }
      .explanation-section {
        margin: 20px auto;
        padding: 15px;
      }
    }

    @media (max-width: 480px) {
      body { margin: 10px; }
      h1 { font-size: 1.5em; }
      canvas { max-width: 95%; }
      a { padding: 6px 12px; font-size: 0.9em; }
      .explanation-section {
        padding: 10px;
        font-size: 0.9em;
      }
    }
  </style>
</head>
<body>
  <h1>🔥 성능 지표 비교</h1>

  <div class="explanation-section">
    <h2>웹사이트 및 용어 설명</h2>
    <h3>이 웹사이트는 무엇인가요?</h3>
    <p>이 웹사이트는 산불 위험을 예측하는 모델의 성능을 시각적으로 비교하고 분석하기 위해 개발되었습니다. 다양한 예측 모델(예: LightGBM, Transformer, 인공위성 규칙 기반)이 산불 발생 가능성을 얼마나 정확하게 예측하는지, 그리고 어떤 지표에서 강점을 보이는지 한눈에 파악할 수 있도록 돕습니다.</p>
    <p>사용자는 이 대시보드를 통해 각 모델의 <b>정확도, 정밀도, 재현율, F1-Score</b>를 비교하여, 어떤 모델이 특정 상황에서 더 적합한지 판단하는 데 도움을 받을 수 있습니다.</p>

    <h3>모델 설명</h3>
    <ul>
      <li><b>LightGBM (Baseline):</b> 기본적인 머신러닝 모델로, 빠르고 효율적인 학습이 특징입니다. 다른 모델들의 성능을 비교하는 기준점(baseline)으로 사용됩니다.</li>
      <li><b>Transformer:</b> 자연어 처리 분야에서 뛰어난 성능을 보이는 모델 구조로, 시계열 데이터나 복잡한 패턴 인식에 활용될 수 있습니다.</li>
      <li><b>인공위성 규칙 기반 (Satellite Rule-Based):</b> 인공위성 데이터를 기반으로 특정 규칙(예: 온도, 강수량, 풍속 등)을 적용하여 산불 위험을 예측하는 모델입니다. 실제 산불 발생 지점의 날씨 데이터를 활용하여 산불 위험도를 판단합니다.</li>
    </ul>

    <h3>성능 지표 설명</h3>
    <ul>
      <li><b>정확도 (Accuracy):</b> 전체 예측 중에서 올바르게 예측한 비율입니다. (예: 산불이 발생한다고 예측했는데 실제로 발생했고, 산불이 발생하지 않는다고 예측했는데 실제로 발생하지 않은 경우)</li>
      <li><b>정밀도 (Precision):</b> 모델이 '산불 발생'이라고 예측한 것 중에서 실제로 산불이 발생한 비율입니다. (오탐을 줄이는 것이 중요할 때 유용)</li>
      <li><b>재현율 (Recall):</b> 실제 산불이 발생한 경우 중에서 모델이 산불이 발생한다고 올바르게 예측한 비율입니다. (실제 산불을 놓치지 않는 것이 중요할 때 유용)</li>
      <li><b>F1-Score:</b> 정밀도와 재현율의 조화 평균입니다. 두 지표의 균형을 고려할 때 사용됩니다.</li>
    </ul>
    <p>이 지표들은 모델이 산불 위험을 얼마나 효과적으로 감지하고 분류하는지 평가하는 데 중요한 역할을 합니다.</p>
  </div>
  <canvas id="metricsChart"></canvas>

  <a href="index.html">← 지도 보기로 돌아가기</a>

  <script>
    fetch('static/metrics.json')
      .then(response => {
        if (!response.ok) {
          throw new Error("metrics.json 파일을 찾을 수 없습니다.");
        }
        return response.json();
      })
      .then(data => {
        const labels = ['정확도 (Accuracy)', '정밀도 (Precision)', '재현율 (Recall)', 'F1-Score'];
        const chartDatasets = [];

        // LightGBM (Baseline) 데이터 처리
        if (data.baseline) {
          chartDatasets.push({
            label: 'LightGBM (Baseline)',
            data: [
              data.baseline.accuracy * 100,
              data.baseline.precision * 100,
              data.baseline.recall * 100,
              data.baseline.f1 * 100
            ],
            backgroundColor: 'rgba(153, 102, 255, 0.7)' // Purple
          });
        }

        // Transformer 데이터 처리
        if (data.transformer) {
          chartDatasets.push({
            label: 'Transformer',
            data: [
              data.transformer.accuracy * 100,
              data.transformer.precision * 100,
              data.transformer.recall * 100,
              data.transformer.f1 * 100
            ],
            backgroundColor: 'rgba(75, 192, 192, 0.7)' // Teal
          });
        }

        // Satellite Rule-Based 모델 데이터 처리
        if (data.satellite_rule_based) {
          chartDatasets.push({
            label: '인공위성 규칙 기반 (Satellite Rule-Based)',
            data: [
              data.satellite_rule_based.accuracy * 100,
              data.satellite_rule_based.precision * 100,
              data.satellite_rule_based.recall * 100,
              data.satellite_rule_based.f1 * 100
            ],
            backgroundColor: 'rgba(255, 99, 132, 0.7)' // Red
          });
        }
        
        if (chartDatasets.length === 0) {
            document.body.innerHTML += '<p>표시할 성능 지표 데이터가 없습니다. 모델을 먼저 훈련시켜 주세요.</p>';
            return;
        }

        const ctx = document.getElementById('metricsChart').getContext('2d');
        new Chart(ctx, {
          type: 'bar',
          data: {
            labels: labels,
            datasets: chartDatasets
          },
          options: {
            responsive: true,
            plugins: {
              title: {
                display: true,
                text: '모델별 성능 지표 비교 (단위: %)',
                font: {
                    size: 18
                }
              },
              tooltip: {
                callbacks: {
                  label: function(context) {
                    let label = context.dataset.label || '';
                    if (label) {
                      label += ': ';
                    }
                    if (context.parsed.y !== null) {
                      label += context.parsed.y.toFixed(2) + '%';
                    }
                    return label;
                  }
                }
              }
            },
            animation: {
              duration: 1500,
              easing: 'easeOutBounce'
            },
            scales: {
              y: {
                beginAtZero: true,
                // max: 100, // y축 최대값을 자동으로 조절하도록 주석 처리
                ticks: {
                  // y축에 % 기호 추가
                  callback: function(value) {
                    return value + '%';
                  }
                }
              }
            }
          }
        });
      })
      .catch(error => {
        console.error('Error fetching or parsing metrics.json:', error);
        document.body.innerHTML += `<p>성능 지표를 불러오는 중 오류가 발생했습니다: ${error.message}</p>`;
      });
  </script>
</body>
</html>
