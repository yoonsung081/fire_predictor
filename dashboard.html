<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="UTF-8">
  <title>🔥 성능 비교 대시보드</title>
  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
  <style>
    body { font-family: Arial, sans-serif; text-align: center; margin: 20px; }
    canvas { max-width: 500px; margin: 30px auto; }
    a { display: inline-block; margin-top: 30px; text-decoration: none; padding: 8px 16px; border: 1px solid #ccc; border-radius: 4px; background: #fff; }
  </style>
</head>
<body>
  <h1>🔥 성능 지표 비교</h1>
  <canvas id="metricsChart"></canvas>

  <a href="index.html">← 지도 보기로 돌아가기</a>

  <script>
    fetch('static/metrics.json')
      .then(response => {
        if (!response.ok) {
          throw new Error("metrics.json 파일을 찾을 수 없습니다.");
        }
        return response.json();
      })
      .then(data => {
        const labels = ['정확도 (Accuracy)', '정밀도 (Precision)', '재현율 (Recall)', 'F1-Score'];
        const chartDatasets = [];

        // LightGBM (Baseline) 데이터 처리
        if (data.baseline) {
          chartDatasets.push({
            label: 'LightGBM (Baseline)',
            data: [
              data.baseline.accuracy * 100,
              data.baseline.precision * 100,
              data.baseline.recall * 100,
              data.baseline.f1 * 100
            ],
            backgroundColor: 'rgba(153, 102, 255, 0.7)' // Purple
          });
        }

        // Transformer 데이터 처리
        if (data.transformer) {
          chartDatasets.push({
            label: 'Transformer',
            data: [
              data.transformer.accuracy * 100,
              data.transformer.precision * 100,
              data.transformer.recall * 100,
              data.transformer.f1 * 100
            ],
            backgroundColor: 'rgba(75, 192, 192, 0.7)' // Teal
          });
        }
        
        if (chartDatasets.length === 0) {
            document.body.innerHTML += '<p>표시할 성능 지표 데이터가 없습니다. 모델을 먼저 훈련시켜 주세요.</p>';
            return;
        }

        const ctx = document.getElementById('metricsChart').getContext('2d');
        new Chart(ctx, {
          type: 'bar',
          data: {
            labels: labels,
            datasets: chartDatasets
          },
          options: {
            responsive: true,
            plugins: {
              title: {
                display: true,
                text: '모델별 성능 지표 비교 (단위: %)',
                font: {
                    size: 18
                }
              },
              tooltip: {
                callbacks: {
                  label: function(context) {
                    let label = context.dataset.label || '';
                    if (label) {
                      label += ': ';
                    }
                    if (context.parsed.y !== null) {
                      label += context.parsed.y.toFixed(2) + '%';
                    }
                    return label;
                  }
                }
              }
            },
            animation: {
              duration: 1500,
              easing: 'easeOutBounce'
            },
            scales: {
              y: {
                beginAtZero: true,
                // max: 100, // y축 최대값을 자동으로 조절하도록 주석 처리
                ticks: {
                  // y축에 % 기호 추가
                  callback: function(value) {
                    return value + '%';
                  }
                }
              }
            }
          }
        });
      })
      .catch(error => {
        console.error('Error fetching or parsing metrics.json:', error);
        document.body.innerHTML += `<p>성능 지표를 불러오는 중 오류가 발생했습니다: ${error.message}</p>`;
      });
  </script>
</body>
</html>
