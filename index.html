<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <title>üî• ÏÇ∞Î∂à ÏòàÏ∏° ÏßÄÎèÑ</title>
    <link rel="stylesheet" href="https://unpkg.com/leaflet/dist/leaflet.css" />
    <link rel="stylesheet" href="https://unpkg.com/leaflet-search/dist/leaflet-search.min.css" />
    <style>
        #map { height: 100vh; }
        .top-right-link {
            position: absolute;
            top: 10px;
            right: 10px;
            background: #fff;
            padding: 6px 10px;
            border-radius: 4px;
            border: 1px solid #ccc;
            text-decoration: none;
            z-index: 1000;
            font-size: 14px;
        }
    </style>
</head>
<body>
    <a href="dashboard.html" class="top-right-link">Ï†ïÌôïÎèÑ ÎπÑÍµê Î≥¥Í∏∞</a>
    <div id="map"></div>

    <script src="https://unpkg.com/leaflet/dist/leaflet.js"></script>
    <script src="https://unpkg.com/leaflet-search/dist/leaflet-search.min.js"></script>

    <script>
        const map = L.map('map').setView([37.5, 128.2], 7);

        const osm = L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', { attribution: 'OpenStreetMap' }).addTo(map);
        const satellite = L.tileLayer('https://server.arcgisonline.com/ArcGIS/rest/services/World_Imagery/MapServer/tile/{z}/{y}/{x}', { attribution: 'Esri' });

        const trueFires = L.layerGroup().addTo(map);
        const predWeather = L.layerGroup().addTo(map);
        const predBaseline = L.layerGroup().addTo(map);

        L.control.layers(
            { "ÏßÄÎèÑ": osm, "ÏúÑÏÑ±": satellite },
            {
                "Ïã§Ï†ú ÏÇ∞Î∂à": trueFires,
                "ÎÇ†Ïî® Í≥†Î†§ ÏòàÏ∏°": predWeather,
                "ÎÇ†Ïî® ÎØ∏Í≥†Î†§ ÏòàÏ∏°": predBaseline
            }
        ).addTo(map);

        function loadGeoJson(url, layerGroup, color) {
            fetch(url)
                .then(res => res.json())
                .then(data => {
                    L.geoJSON(data, {
                        pointToLayer: (feature, latlng) =>
                            L.circleMarker(latlng, {
                                radius: 5,
                                fillColor: color,
                                color: '#000',
                                weight: 1,
                                opacity: 1,
                                fillOpacity: 0.8
                            }),
                        onEachFeature: (feature, layer) => {
                            if (feature.properties && feature.properties.popup) {
                                layer.bindPopup(feature.properties.popup);
                            }
                        }
                    }).addTo(layerGroup);
                });
        }

        loadGeoJson('data/true_fires.geojson', trueFires, 'red');
        loadGeoJson('data/predicted_weather.geojson', predWeather, 'blue');
        loadGeoJson('data/predicted_baseline.geojson', predBaseline, 'orange');

        const searchControl = new L.Control.Search({
            url: 'https://nominatim.openstreetmap.org/search?format=json&q={s}',
            jsonpParam: 'json_callback',
            propertyName: 'display_name',
            propertyLoc: ['lat','lon'],
            autoCollapse: true,
            autoType: false,
            minLength: 2,
            zoom: 12
        });

        searchControl.on('search:locationfound', function(e) {
            map.setView(e.latlng, 12);
        });

        map.addControl(searchControl);
    </script>
</body>
</html>
